<div class="gradient-bg text-gray-100 h-screen overflow-hidden">
  <!-- Top Bar -->
  <header class="flex items-center justify-between px-6 py-3 bg-gray-800 bg-opacity-90 backdrop-filter backdrop-blur-lg border-b border-gray-700 z-50">
    <div class="flex items-center space-x-4">
      <div class="flex items-center space-x-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path d="M12 14l9-5-9-5-9 5 9 5z" />
          <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222" />
        </svg>
        <span class="text-xl font-bold text-gradient">EduTech Meet</span>
      </div>
      <div class="text-sm text-gray-400">
        <span>Révision JavaScript - </span>
        <span class="font-medium">Prof. Martin</span>
      </div>
    </div>

    <div class="flex items-center space-x-4">
      <div class="flex items-center text-sm text-gray-400">
        <i class="fas fa-clock mr-2"></i>
        <span>{{ meetingTimer | date: 'HH:mm:ss' }}</span>
      </div>
      <div class="flex items-center text-sm text-gray-400">
        <i class="fas fa-users mr-2"></i>
        <span>{{ participants.length }}</span>
        <span> participants</span>
      </div>
    </div>

    <div class="flex items-center space-x-3">
      <button class="text-gray-400 hover:text-white p-2 rounded-lg bg-gray-700 bg-opacity-50" (click)="openSettings()">
        <i class="fas fa-cog"></i>
      </button>
      <button class="text-gray-400 hover:text-white p-2 rounded-lg bg-gray-700 bg-opacity-50" (click)="openInfo()">
        <i class="fas fa-info-circle"></i>
      </button>
      <button class="text-red-400 hover:text-red-300 p-2 rounded-lg bg-red-900 bg-opacity-20" (click)="minimizeCall()">
        <i class="fas fa-compress"></i>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <div class="flex-1 flex h-full overflow-hidden">
    <!-- Video Grid -->
    <div class="flex-1 p-4 overflow-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        <!-- Self Video -->
        <div class="video-container col-span-1 md:col-span-2 lg:col-span-3 xl:col-span-2 animate-fade-in relative" [ngClass]="{'active-speaker': selfParticipant.isSpeaking}">
          <div class="w-full h-64 md:h-72 lg:h-80 bg-gray-900 rounded-xl flex items-center justify-center">
            <img *ngIf="selfParticipant.isVideoOff" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Vous" class="w-24 h-24 rounded-full object-cover">
            <video *ngIf="!selfParticipant.isVideoOff" class="w-full h-full object-cover rounded-xl" autoplay muted></video>
          </div>
          <div class="participant-info absolute bottom-0 left-0 right-0 p-3 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                <span class="participant-status" [ngClass]="{
                  'muted': selfParticipant.isMuted,
                  'speaking': selfParticipant.isSpeaking && !selfParticipant.isMuted,
                  'normal': !selfParticipant.isMuted && !selfParticipant.isSpeaking
                }"></span>
                <span class="font-medium">Marie Dupont (Vous)</span>
              </div>
              <div class="flex items-center space-x-2">
                <span *ngIf="selfParticipant.isMuted" class="bg-red-500 bg-opacity-80 text-xs px-2 py-1 rounded">Micro désactivé</span>
                <span *ngIf="selfParticipant.isVideoOff" class="bg-gray-700 bg-opacity-80 text-xs px-2 py-1 rounded">Caméra désactivée</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Other Participants -->
        <div *ngFor="let participant of participants" class="video-container animate-fade-in relative" [ngClass]="{'active-speaker': participant.isSpeaking}">
          <div class="w-full h-64 md:h-72 lg:h-80 bg-gray-800 rounded-xl flex items-center justify-center">
            <img *ngIf="participant.isVideoOff" [src]="participant.avatar" alt="Participant" class="w-full h-full object-cover rounded-xl">
            <video *ngIf="!participant.isVideoOff" class="w-full h-full object-cover rounded-xl" autoplay muted></video>
          </div>
          <div class="participant-info absolute bottom-0 left-0 right-0 p-3 text-white">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                <span class="participant-status" [ngClass]="{
                  'muted': participant.isMuted,
                  'speaking': participant.isSpeaking && !participant.isMuted,
                  'normal': !participant.isMuted && !participant.isSpeaking
                }"></span>
                <span class="font-medium">{{ participant.name }}</span>
              </div>
              <div class="flex items-center space-x-2">
                <i *ngIf="participant.isMuted" class="fas fa-microphone-slash text-red-400"></i>
                <i *ngIf="!participant.isMuted" class="fas fa-volume-up text-green-400"></i>
                <i *ngIf="!participant.isVideoOff" class="fas fa-video text-blue-400"></i>
                <i *ngIf="participant.isVideoOff" class="fas fa-video-slash text-gray-400"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar (Chat and Participants) -->
    <div class="w-0 md:w-80 flex flex-col border-l border-gray-700" [ngClass]="{'hidden': !isSidebarOpen}">
      <!-- Chat Toggle Buttons -->
      <div class="flex border-b border-gray-700">
        <button class="flex-1 py-3 text-center font-medium" [ngClass]="{'bg-gray-800 bg-opacity-50': activeSidebarTab === 'chat', 'text-gray-500': activeSidebarTab !== 'chat'}" (click)="setSidebarTab('chat')">
          <i class="fas fa-comments mr-2"></i>Chat
        </button>
        <button class="flex-1 py-3 text-center font-medium" [ngClass]="{'bg-gray-800 bg-opacity-50': activeSidebarTab === 'participants', 'text-gray-500': activeSidebarTab !== 'participants'}" (click)="setSidebarTab('participants')">
          <i class="fas fa-users mr-2"></i>Participants
        </button>
      </div>

      <!-- Chat Container -->
      <div class="flex-1 flex flex-col" [ngClass]="{'hidden': activeSidebarTab !== 'chat'}">
        <!-- Chat Messages -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4" #chatMessages>
          <div *ngFor="let message of chatMessagesList" [ngClass]="{
            'message-system p-3 text-center text-sm': message.type === 'system',
            'message-other p-3': message.type === 'other',
            'message-self p-3 ml-10': message.type === 'self'
          }">
            <div *ngIf="message.type !== 'system'" class="font-medium">{{ message.sender }}</div>
            <p>{{ message.content }}</p>
            <div class="text-xs text-gray-400 mt-1">{{ message.timestamp | date: 'HH:mm' }}</div>
          </div>
        </div>

        <!-- Chat Input -->
        <div class="p-3 border-t border-gray-700">
          <div class="flex items-center space-x-2">
            <button class="text-gray-400 hover:text-white p-2" (click)="openEmojiPicker()">
              <i class="far fa-smile"></i>
            </button>
            <input type="text" placeholder="Écrivez votre message..." class="flex-1 bg-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" [(ngModel)]="newMessage" (keyup.enter)="sendMessage()">
            <button class="text-blue-400 hover:text-blue-300 p-2" (click)="sendMessage()">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Participants Container -->
      <div class="flex-1 flex-col" [ngClass]="{'hidden': activeSidebarTab !== 'participants'}">
        <div class="p-4">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-medium">Participants ({{ participants.length + 1 }})</h3>
            <button class="text-gray-400 hover:text-white" (click)="searchParticipants()">
              <i class="fas fa-search"></i>
            </button>
          </div>

          <div class="space-y-3">
            <div class="flex items-center justify-between p-2 rounded-lg bg-gray-700 bg-opacity-50">
              <div class="flex items-center space-x-3">
                <div class="relative">
                  <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Vous" class="w-8 h-8 rounded-full participant-avatar">
                  <span class="participant-status absolute -bottom-1 -right-1" [ngClass]="{
                    'muted': selfParticipant.isMuted,
                    'speaking': selfParticipant.isSpeaking && !selfParticipant.isMuted,
                    'normal': !selfParticipant.isMuted && !selfParticipant.isSpeaking
                  }"></span>
                </div>
                <div>
                  <div class="font-medium">Marie Dupont</div>
                  <div class="text-xs text-gray-400">Vous</div>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <i *ngIf="selfParticipant.isMuted" class="fas fa-microphone-slash text-red-400"></i>
                <i *ngIf="!selfParticipant.isMuted" class="fas fa-microphone text-green-400"></i>
                <i *ngIf="!selfParticipant.isVideoOff" class="fas fa-video text-blue-400"></i>
                <i *ngIf="selfParticipant.isVideoOff" class="fas fa-video-slash text-gray-400"></i>
              </div>
            </div>

            <div *ngFor="let participant of participants" class="flex items-center justify-between p-2 rounded-lg bg-gray-700 bg-opacity-50">
              <div class="flex items-center space-x-3">
                <div class="relative">
                  <img [src]="participant.avatar" alt="Participant" class="w-8 h-8 rounded-full participant-avatar">
                  <span class="participant-status absolute -bottom-1 -right-1" [ngClass]="{
                    'muted': participant.isMuted,
                    'speaking': participant.isSpeaking && !participant.isMuted,
                    'normal': !participant.isMuted && !participant.isSpeaking
                  }"></span>
                </div>
                <div>
                  <div class="font-medium">{{ participant.name }}</div>
                  <div *ngIf="participant.isOrganizer" class="text-xs text-gray-400">Organisateur</div>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <i *ngIf="participant.isMuted" class="fas fa-microphone-slash text-red-400"></i>
                <i *ngIf="!participant.isMuted" class="fas fa-microphone text-green-400"></i>
                <i *ngIf="!participant.isVideoOff" class="fas fa-video text-blue-400"></i>
                <i *ngIf="participant.isVideoOff" class="fas fa-video-slash text-gray-400"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls Bar -->
  <div class="flex items-center justify-center p-4">
    <div class="controls-container px-6 py-3 flex items-center space-x-4 animate__animated animate__fadeInUp">
      <button class="control-btn p-3 bg-gray-700 bg-opacity-50" [ngClass]="{'mic-muted': selfParticipant.isMuted}" (click)="toggleMic()">
        <i class="fas" [ngClass]="selfParticipant.isMuted ? 'fa-microphone-slash text-red-400' : 'fa-microphone text-white'"></i>
      </button>

      <button class="control-btn p-3 bg-gray-700 bg-opacity-50" [ngClass]="{'video-off': selfParticipant.isVideoOff}" (click)="toggleVideo()">
        <i class="fas" [ngClass]="selfParticipant.isVideoOff ? 'fa-video-slash text-gray-400' : 'fa-video text-white'"></i>
      </button>

      <button class="control-btn p-3 bg-gray-700 bg-opacity-50" [ngClass]="{'screen-share-active': isScreenSharing}" (click)="toggleScreenShare()">
        <i class="fas" [ngClass]="isScreenSharing ? 'fa-stop-circle text-white' : 'fa-desktop text-white'"></i>
      </button>

      <button class="control-btn p-3 bg-blue-600" (click)="raiseHand()">
        <i class="fas fa-hand-paper text-white"></i>
      </button>

      <button class="control-btn p-3 bg-gray-700 bg-opacity-50" (click)="toggleSidebar('chat')">
        <i class="fas fa-comments text-white"></i>
      </button>

      <button class="control-btn p-3 bg-gray-700 bg-opacity-50" (click)="toggleSidebar('participants')">
        <i class="fas fa-users text-white"></i>
      </button>

      <button class="control-btn p-3 bg-gray-700 bg-opacity-50" (click)="openMoreOptions()">
        <i class="fas fa-ellipsis-h text-white"></i>
      </button>

      <button class="control-btn p-3 leave-call bg-red-600" (click)="leaveCall()">
        <i class="fas fa-phone-slash text-white"></i>
      </button>
    </div>
  </div>

  <!-- Reaction Overlay -->
  <div class="fixed bottom-24 left-1/2 transform -translate-x-1/2 flex space-x-4">
    <div *ngFor="let reaction of reactions" class="reaction bg-gray-800 rounded-full p-2" [ngClass]="{'text-2xl': reaction.type === 'emoji'}">
      <i *ngIf="reaction.type !== 'emoji'" class="fas" [ngClass]="reaction.iconClass"></i>
      <span *ngIf="reaction.type === 'emoji'">{{ reaction.content }}</span>
    </div>
  </div>
</div>